<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Minirhizotron Scans Analysis with RootScanR in R â€¢ RootScanR</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Aleo-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Minirhizotron Scans Analysis with RootScanR in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RootScanR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/RootScanR.html">Tutorial</a></li>
<li class="nav-item"><h6 class="dropdown-header" data-toc-skip>DemoFile</h6></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jcunow/RootScanR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Minirhizotron Scans Analysis with RootScanR in R</h1>
                        <h4 data-toc-skip class="author">Johannes
Cunow</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jcunow/RootScanR/blob/main/vignettes/MinirhizotronScans_vignettes.Rmd" class="external-link"><code>vignettes/MinirhizotronScans_vignettes.Rmd</code></a></small>
      <div class="d-none name"><code>MinirhizotronScans_vignettes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="minirhizotron-scans-analysis-with-rootscanr">Minirhizotron Scans Analysis with RootScanR<a class="anchor" aria-label="anchor" href="#minirhizotron-scans-analysis-with-rootscanr"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette demonstrates how to analyze minirhizotron scans using
the <strong>RootScanR</strong> package. Minirhizotrons are transparent
tubes inserted into soil to observe root growth via scanning or imaging
technology. RootScanR is designed for comprehensive analysis of these
root system images, providing tools for image preparation, depth
mapping, and extraction of meaningful root traits. To extract root
traits, segmenting the image outside R is needed (see step 2).</p>
</div>
<div class="section level3">
<h3 id="key-functionalities">Key Functionalities<a class="anchor" aria-label="anchor" href="#key-functionalities"></a>
</h3>
<p>A typical workflow to analyze minirhizotron scans could look
something like the following. Step 2 and step 3 depend</p>
<ol style="list-style-type: decimal">
<li>
<strong>Image Stitching</strong>: Combine sequential minirhizotron
images to create complete tube scans</li>
<li>
<strong>AI-Based Image Segmentation</strong>: Work with images
segmented by dedicated root detection software</li>
<li>
<strong>In-situ Calibration</strong>: Needed to accurately map image
pixels to soil depth. An alternative is shown here but requires special
attention</li>
<li>
<strong>Depthmap Creation</strong>: Generate depth information for
each pixel in the root scans</li>
<li>
<strong>Root Trait Extraction</strong>: Calculate important root
metrics (length, density, branching, etc.)</li>
<li>
<strong>Spatial Root Features</strong> Extracting spatial-explicit
root scape features e.g., entropy, root instance count, fractal
dimension</li>
<li>
<strong>Soil Characterization</strong>: Analyze soil/peat properties
from scan images</li>
</ol>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the package from GitHub</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="co"># remotes::install_github("jcunow/RootScanR")</span></span>
<span></span>
<span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jcunow/RootScanR" class="external-link">RootScanR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co"># For data manipulation and visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span>      <span class="co"># For raster image handling</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h3>
<div class="section level4">
<h4 id="image-stitching">1. Image Stitching<a class="anchor" aria-label="anchor" href="#image-stitching"></a>
</h4>
<p><strong>Purpose</strong>: Combine multiple sequential images from
longer minirhizotron tubes into a single composite image to enable
proper depth alignment and remove overlap between images.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example image files (replace with your actual file paths)</span></span>
<span><span class="va">image_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/image1.png"</span>, <span class="st">"path/to/image2.png"</span>, <span class="st">"path/to/image3.png"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stitch images together (removes redundant overlap)</span></span>
<span><span class="va">stitched_image</span> <span class="op">&lt;-</span> <span class="fu">RootScanR</span><span class="fu">::</span><span class="fu"><a href="../reference/stitch_sequential_images.html">stitch_sequential_images</a></span><span class="op">(</span><span class="va">image_files</span>, </span>
<span>                                                      overlap_px <span class="op">=</span> <span class="fl">200</span>, </span>
<span>                                                      method <span class="op">=</span> <span class="st">"crosscorr"</span>,</span>
<span>                                                      side1 <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="co"># Visualize the stitched image</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stitched_image</span>, main <span class="op">=</span> <span class="st">"Stitched Minirhizotron Image"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="image-segmentation-recommendations">2. Image Segmentation Recommendations<a class="anchor" aria-label="anchor" href="#image-segmentation-recommendations"></a>
</h4>
<p><strong>Purpose</strong>: Separate roots from background in the
minirhizotron images.</p>
<p>RootScanR works with segmented images but does not perform
segmentation itself. We recommend using specialized tools:</p>
<ol style="list-style-type: decimal">
<li>
<strong>RootDetector</strong> (<a href="https://github.com/ExPlEcoGreifswald/RootDetector" class="external-link">GitHub</a>)
<ul>
<li>Returns segmented and skeletonized images with different information
channels</li>
<li>Can distinguish between tape, roots, and background</li>
<li>Supports root tracking for production, decay, and turnover
analysis</li>
<li>Reference: Peters et al.Â (2023), <em>Scientific Reports</em>
<strong>13</strong>(1)</li>
</ul>
</li>
<li>
<strong>RootPainter</strong> (<a href="https://github.com/Abe404/root_painter" class="external-link">GitHub</a>)
<ul>
<li>Returns segmented images</li>
<li>Uses interactive deep learning for improved segmentation</li>
<li>Reference: Smith et al.Â (2022), <em>New Phytologist</em>
<strong>236</strong>(2)</li>
</ul>
</li>
</ol>
<p><strong>Tip</strong>: For images with high root density, consider
splitting your stitched images before segmentation and rejoining
afterwards. <strong>Tip</strong>: Models can be sensitive to resolution.
Try</p>
</div>
<div class="section level4">
<h4 id="loading-images">3. Loading Images<a class="anchor" aria-label="anchor" href="#loading-images"></a>
</h4>
<p><strong>Purpose</strong>: Import your segmented and original RGB
images for analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load a segmented image (replace with your file path). The function accepts multiple different input formats.</span></span>
<span><span class="va">segmented_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_flexible_image.html">load_flexible_image</a></span><span class="op">(</span><span class="st">"path/to/segmented_image.tif"</span>, output_format <span class="op">=</span> <span class="st">"spatrast"</span>, normalize <span class="op">=</span> <span class="cn">F</span>, select.layer <span class="op">=</span> <span class="cn">NULL</span>, binarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load corresponding RGB image for visual reference</span></span>
<span><span class="va">rgb_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_flexible_image.html">load_flexible_image</a></span><span class="op">(</span><span class="st">"path/to/rgb_image.tif"</span>, output_format <span class="op">=</span> <span class="st">"spatrast"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the images</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rgb_image</span>, main <span class="op">=</span> <span class="st">"Original RGB Image"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">segmented_image</span>, main <span class="op">=</span> <span class="st">"Segmented Image"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tube-calibration">4. Tube Calibration<a class="anchor" aria-label="anchor" href="#tube-calibration"></a>
</h4>
<p><strong>Purpose</strong>: Establish the relationship between image
pixels and actual soil depth.</p>
<p>In-situ calibration is highly recommended for accurate depth
attribution. If calibration data is unavailable, RootScanR provides
estimation functions using tape cover as proxy:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate soil surface position based on tape cover. Here, 0.5 cm of tape beyond the true soil surface is assumed to block out light.</span></span>
<span><span class="va">soil_surface</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_soil_surface.html">estimate_soil_surface</a></span><span class="op">(</span><span class="va">rgb_image</span>, dpi <span class="op">=</span> <span class="fl">300</span>, tape.overlap <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Estimated soil surface begins at column: "</span>, <span class="va">soil_surface</span><span class="op">$</span><span class="va">soil0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate rotation center. This only works for asymmetric taping around the tube with more on the uside. </span></span>
<span><span class="va">rotation_center</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_rotation_center.html">estimate_rotation_center</a></span><span class="op">(</span><span class="va">rgb_image</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Estimated rotation center at row: "</span>, <span class="va">rotation_center</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="depthmap-creation">5. Depthmap Creation<a class="anchor" aria-label="anchor" href="#depthmap-creation"></a>
</h4>
<p><strong>Purpose</strong>: Create a map that assigns soil depth values
to each pixel in the image.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a mask to exclude tape from soil analysis</span></span>
<span><span class="co"># Assuming RootDetector format where red channel includes tape</span></span>
<span><span class="va">tape_mask</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">segmented_image</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">segmented_image</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">255</span></span>
<span><span class="va">tape_mask</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tape_mask</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate normalized rotation center position</span></span>
<span><span class="va">center_offset</span> <span class="op">&lt;-</span> <span class="va">rotation_center</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">segmented_image</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create the depthmap</span></span>
<span><span class="va">depth_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_depthmap.html">create_depthmap</a></span><span class="op">(</span></span>
<span>  image <span class="op">=</span> <span class="va">segmented_image</span>, </span>
<span>  sinusoidal <span class="op">=</span> <span class="cn">TRUE</span>,    <span class="co"># Account for tube curvature</span></span>
<span>  mask <span class="op">=</span> <span class="va">tape_mask</span>,</span>
<span>  soil_start <span class="op">=</span> <span class="va">soil_surface</span>,</span>
<span>  center_offset <span class="op">=</span> <span class="va">center_offset</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the depthmap</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">depth_map</span>, main <span class="op">=</span> <span class="st">"Depth Map"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="depth-binning">6. Depth Binning<a class="anchor" aria-label="anchor" href="#depth-binning"></a>
</h4>
<p><strong>Purpose</strong>: Group depths into discrete intervals for
statistical analysis and visualization.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create depth bins (5cm intervals)</span></span>
<span><span class="va">binned_map</span> <span class="op">&lt;-</span> <span class="fu">bin_depths</span><span class="op">(</span><span class="va">depth_map</span>, interval <span class="op">=</span> <span class="fl">5</span>, method <span class="op">=</span> <span class="st">"rounding"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correct extent for plotting</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">binned_map</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">binned_map</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">binned_map</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize binned depthmap</span></span>
<span><span class="va">transposed_map</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="va">binned_map</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">transposed_map</span>, main <span class="op">=</span> <span class="st">"Binned Depth Map (5cm intervals)"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="root-skeletonization">7. Root Skeletonization<a class="anchor" aria-label="anchor" href="#root-skeletonization"></a>
</h4>
<p><strong>Purpose</strong>: Create a single-pixel-wide representation
of root structure for morphological analysis.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create root skeleton using Medial Axis Transform (MAT) method</span></span>
<span><span class="co"># Select layer 2 which typically contains root information in RootDetector output</span></span>
<span><span class="va">skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/skeletonize_image.html">skeletonize_image</a></span><span class="op">(</span></span>
<span>  <span class="va">segmented_image</span>, </span>
<span>  method <span class="op">=</span> <span class="st">"MAT"</span>, </span>
<span>  select.layer <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize skeleton</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">skeleton</span>, main <span class="op">=</span> <span class="st">"Root Skeleton"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="root-trait-extraction">8. Root Trait Extraction<a class="anchor" aria-label="anchor" href="#root-trait-extraction"></a>
</h4>
<p><strong>Purpose</strong>: Calculate quantitative root system traits
for ecological analysis.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect endpoints and branching points</span></span>
<span><span class="va">skeleton_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_skeleton_points.html">detect_skeleton_points</a></span><span class="op">(</span><span class="va">skeleton</span><span class="op">)</span></span>
<span><span class="va">root_tips</span> <span class="op">&lt;-</span> <span class="fu">px.sum</span><span class="op">(</span><span class="va">skeleton_points</span><span class="op">$</span><span class="va">endpoints</span><span class="op">)</span></span>
<span><span class="va">branching_points</span> <span class="op">&lt;-</span> <span class="fu">px.sum</span><span class="op">(</span><span class="va">skeleton_points</span><span class="op">$</span><span class="va">branching_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Number of root tips: "</span>, <span class="va">root_tips</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Number of branching points: "</span>, <span class="va">branching_points</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate root length using Kimura's method</span></span>
<span><span class="va">root_length</span> <span class="op">&lt;-</span> <span class="fu">RootLength</span><span class="op">(</span><span class="va">skeleton</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Total root length (cm): "</span>, <span class="va">root_length</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate root density</span></span>
<span><span class="co"># Create binary mask of non-root area</span></span>
<span><span class="va">void_area</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">prepare_binary_image</span><span class="op">(</span><span class="va">segmented_image</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">root_pixels</span> <span class="op">&lt;-</span> <span class="fu">px.sum</span><span class="op">(</span><span class="va">segmented_image</span>, layer <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">void_pixels</span> <span class="op">&lt;-</span> <span class="fu">px.sum</span><span class="op">(</span><span class="va">void_area</span>, layer <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">root_density</span> <span class="op">&lt;-</span> <span class="va">root_pixels</span> <span class="op">/</span> <span class="op">(</span><span class="va">root_pixels</span> <span class="op">+</span> <span class="va">void_pixels</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Root density: "</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">root_density</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate maximum rooting depth ("deep drive")</span></span>
<span><span class="va">deep_drive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deep_drive.html">deep_drive</a></span><span class="op">(</span></span>
<span>  RootMap <span class="op">=</span> <span class="va">segmented_image</span>, </span>
<span>  DepthMap <span class="op">=</span> <span class="va">depth_map</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Maximum rooting depth (cm): "</span>, <span class="va">deep_drive</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate landscape metrics for root architecture</span></span>
<span><span class="va">root_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/root_scape_metrics.html">root_scape_metrics</a></span><span class="op">(</span></span>
<span>  img <span class="op">=</span> <span class="va">segmented_image</span>, </span>
<span>  indexD <span class="op">=</span> <span class="fl">5</span>, </span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lsm_c_ca"</span>, <span class="st">"lsm_l_ent"</span>, <span class="st">"lsm_c_pd"</span>, <span class="st">"lsm_c_enn_mn"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Root architecture metrics:"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">root_metrics</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="soilpeat-characterization">9. Soil/Peat Characterization<a class="anchor" aria-label="anchor" href="#soilpeat-characterization"></a>
</h4>
<p><strong>Purpose</strong>: Analyze soil properties visible in the
minirhizotron images.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze overall tube color</span></span>
<span><span class="va">tube_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tube_coloration.html">tube_coloration</a></span><span class="op">(</span><span class="va">rgb_image</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Overall tube color metrics:"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tube_color</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create buffer around roots to analyze soil without root &amp; rhizosphere influence</span></span>
<span><span class="va">root_buffer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_root_buffer.html">create_root_buffer</a></span><span class="op">(</span><span class="va">segmented_image</span>, width <span class="op">=</span> <span class="fl">2</span>, halo.only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create soil-only image by removing root areas</span></span>
<span><span class="va">soil_image</span> <span class="op">&lt;-</span> <span class="va">rgb_image</span> <span class="op">-</span> <span class="va">root_buffer</span></span>
<span></span>
<span><span class="co"># Analyze soil color</span></span>
<span><span class="va">soil_color</span> <span class="op">&lt;-</span> <span class="fu">tube_color</span><span class="op">(</span><span class="va">soil_image</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Soil color metrics:"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">soil_color</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract soil texture information using GLCM (Gray-Level Co-occurrence Matrix)</span></span>
<span><span class="va">gray_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgb2gray.html">rgb2gray</a></span><span class="op">(</span><span class="va">soil_image</span><span class="op">)</span></span>
<span><span class="va">soil_texture</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_soil_texture.html">analyze_soil_texture</a></span><span class="op">(</span></span>
<span>  <span class="va">gray_image</span>,</span>
<span>  gray_levels <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  statistics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"second_moment"</span>, <span class="st">"homogeneity"</span><span class="op">)</span>,</span>
<span>  directions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Soil texture metrics:"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">soil_texture</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="depth-based-analysis">10. Depth-Based Analysis<a class="anchor" aria-label="anchor" href="#depth-based-analysis"></a>
</h4>
<p><strong>Purpose</strong>: Analyze how root traits change with soil
depth.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create analytical zones; indexD indicates which depth to look at.</span></span>
<span><span class="va">root_zone</span> <span class="op">=</span> <span class="fu"><a href="../reference/zone.fun.html">zone.fun</a></span><span class="op">(</span>rootpic <span class="op">=</span> <span class="va">root_map</span>, </span>
<span>                     indexD <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                     binned.map <span class="op">=</span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>depthmap <span class="op">=</span> <span class="va">depth_map</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># go through each slice</span></span>
<span><span class="va">bin_width</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">rl.df</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span>,<span class="va">bin_width</span><span class="op">)</span>, rl <span class="op">=</span> <span class="cn">NA</span>,rl.density <span class="op">=</span> <span class="cn">NA</span>, rootpx <span class="op">=</span> <span class="cn">NA</span>, voidpx <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">root_map</span> <span class="op">=</span>  <span class="fu"><a href="../reference/load_flexible_image.html">load_flexible_image</a></span><span class="op">(</span><span class="va">root_map</span>,binarize <span class="op">=</span> <span class="cn">TRUE</span>, output_format <span class="op">=</span> <span class="st">"spatrast"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># analytical unit</span></span>
<span>  <span class="va">root_zone</span> <span class="op">=</span> <span class="fu"><a href="../reference/zone.fun.html">zone.fun</a></span><span class="op">(</span>rootpic <span class="op">=</span> <span class="va">root_map</span> , </span>
<span>                     indexD <span class="op">=</span> <span class="va">i</span>,</span>
<span>                     binned.map <span class="op">=</span>  <span class="fu"><a href="../reference/binning.html">binning</a></span><span class="op">(</span>depthmap <span class="op">=</span> <span class="va">depth_map</span>, <span class="va">bin_width</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="co"># root length</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">rl.df</span><span class="op">$</span><span class="va">rl</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="../reference/root_length.html">root_length</a></span><span class="op">(</span><span class="va">root_zone</span>,dpi <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="co"># available root pixels</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">rl.df</span><span class="op">$</span><span class="va">rootpx</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">px.sum</span><span class="op">(</span><span class="va">root_zone</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># available soil &amp; tape pixels (inverse roots)</span></span>
<span>    <span class="va">voidpx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">root_zone</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">rl.df</span><span class="op">$</span><span class="va">voidpx</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">px.sum</span><span class="op">(</span><span class="va">voidpx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># calculate rootlength density</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">rl.df</span><span class="op">$</span><span class="va">rl.density</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rl.df</span><span class="op">$</span><span class="va">rl</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="va">rl.df</span><span class="op">$</span><span class="va">rootpx</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">rl.df</span><span class="op">$</span><span class="va">voidpx</span><span class="op">[</span><span class="va">rl.df</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Visualize results</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rl.df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">depth</span>, y <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">rl.density</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">rootpx</span><span class="op">)</span><span class="op">)</span>,color <span class="op">=</span> <span class="st">"steelblue4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">rootpx</span><span class="op">)</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"steelblue4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">voidpx</span><span class="op">+</span><span class="va">rootpx</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">voidpx</span><span class="op">+</span><span class="va">rootpx</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Root Length by Soil Depth"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Soil Depth (cm)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"standard deviation"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>This vignette demonstrates the core workflows for analyzing
minirhizotron images with RootScanR. For more detailed information about
specific functions and additional features, please refer to the function
documentation and the package GitHub repository at <a href="https://github.com/jcunow/RootScanR" class="external-link">https://github.com/jcunow/RootScanR</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Cunow.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
